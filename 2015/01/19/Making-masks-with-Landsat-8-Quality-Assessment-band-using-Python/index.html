<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Making masks with Landsat 8 Quality Assessment band using Python | Joe&#39;s Talk</title><meta name="description" content><meta name="keywords" content><meta name="HandheldFriendly" content="True"><meta name="apple-mobile-web-app-capable" content="yes"><link rel="shortcut icon" href="/blog/"><link rel="alternate" href="/blog/atom.xml" title="Joe's Talk"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1"><meta name="description" content="Update Since 0.2.0, the qabmasker has been renamed as landsatmasker and the function getmask has been renamed as getmultimask for better identification. Please update your script accordingly.Update Si"><meta name="keywords" content="remote sensing,landsat,python"><meta property="og:type" content="article"><meta property="og:title" content="Making masks with Landsat 8 Quality Assessment band using Python"><meta property="og:url" content="http://haoliangyu.github.io/blog/2015/01/19/Making-masks-with-Landsat-8-Quality-Assessment-band-using-Python/index.html"><meta property="og:site_name" content="Joe&#39;s Talk"><meta property="og:description" content="Update Since 0.2.0, the qabmasker has been renamed as landsatmasker and the function getmask has been renamed as getmultimask for better identification. Please update your script accordingly.Update Si"><meta property="og:locale" content="default"><meta property="og:updated_time" content="2018-03-03T20:45:36.118Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Making masks with Landsat 8 Quality Assessment band using Python"><meta name="twitter:description" content="Update Since 0.2.0, the qabmasker has been renamed as landsatmasker and the function getmask has been renamed as getmultimask for better identification. Please update your script accordingly.Update Si"><link href="https://fonts.googleapis.com/css?family=Inconsolata|Titillium+Web" rel="stylesheet"><link href="https://fonts.googleapis.com/css?family=Roboto+Mono" rel="stylesheet"><link href="//cdn.bootcss.com/node-waves/0.7.5/waves.min.css" rel="stylesheet"><link rel="stylesheet" href="/blog/style.css"><script>function setLoadingBarProgress(e){document.getElementById("loading-bar").style.width=e+"%"}</script><script async src="https://www.googletagmanager.com/gtag/js?id=UA-117921545-1"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-117921545-1")</script></head></html><body><div id="loading-bar-wrapper"><div id="loading-bar"></div></div><script>setLoadingBarProgress(20)</script><header class="l_header"><div class="wrapper"><div class="nav-main container container--flex"><a class="logo flat-box" href="/blog/">Joe's Talk</a><div class="menu"><ul class="h-list"><li><a class="flat-box nav-home" href="/blog/">Home</a></li><li><a class="flat-box nav-archives" href="/blog/archives">Archives</a></li></ul><div class="underline"></div></div><div class="m_search"><form name="searchform" class="form u-search-form"><input type="text" class="input u-search-input" placeholder="Search"> <span class="icon icon-search"></span></form></div><ul class="switcher h-list"><li class="s-search"><a href="javascript:void(0)"><span class="icon icon-search flat-box"></span></a></li><li class="s-menu"><a href="javascript:void(0)"><span class="icon icon-menu flat-box"></span></a></li></ul></div><div class="nav-sub container container--flex"><a class="logo" href="javascript:void(0)">Word of Forks</a><ul class="switcher h-list"><li class="s-comment"><a href="javascript:void(0)"><span class="icon icon-chat_bubble_outline flat-box"></span></a></li><li class="s-top"><a href="javascript:void(0)"><span class="icon icon-arrow_upward flat-box"></span></a></li><li class="s-toc"><a href="javascript:void(0)"><span class="icon icon-format_list_numbered flat-box"></span></a></li></ul></div></div></header><aside class="menu-phone"><nav><a href="/blog/" class="nav-home nav">Home </a><a href="/blog/archives" class="nav-archives nav">Archives</a></nav></aside><script>setLoadingBarProgress(40)</script><div class="l_body"><div class="container clearfix"><div class="l_main"><article id="post-Making-masks-with-Landsat-8-Quality-Assessment-band-using-Python" class="post white-box article-type-post" itemscope itemprop="blogPost"><section class="meta"><h2 class="title"><a href="/blog/2015/01/19/Making-masks-with-Landsat-8-Quality-Assessment-band-using-Python/">Making masks with Landsat 8 Quality Assessment band using Python</a></h2><time>Jan 19, 2015</time><div class="cats"><a href="/blog/categories/GIS/">GIS</a></div></section><section class="toc-wrapper"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#Installation"><span class="toc-number">1.</span> <span class="toc-text">Installation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Sample"><span class="toc-number">2.</span> <span class="toc-text">Sample</span></a></li></ol></section><section class="article typo"><div class="article-entry" itemprop="articleBody"><p><strong>Update</strong> Since 0.2.0, the <em>qabmasker</em> has been renamed as <em>landsatmasker</em> and the function <em>getmask</em> has been renamed as <em>getmultimask</em> for better identification. Please update your script accordingly.</p><p><strong>Update</strong> Since 0.3.0, most class and function names have been updated according to the pep8.</p><p>The Quality Assessment (QA) band is a standard product included in each Landsat 8 image downloaded from USGS, which contains the quality information of each pixel such as cloud, snow/ice, water body etc. The detailed information of this band can be found at <a href="http://landsat.usgs.gov/L8QualityAssessmentBand.php" target="_blank" rel="noopener">Landsat 8 Quality Assessment Band</a>.<br><a id="more"></a><br>Although the bits structure of the QA band is easy-to-understand, it would several steps to extract the desired mask in <a href="http://courses.neteler.org/processing-landsat8-data-in-grass-gis-7/" target="_blank" rel="noopener">QGIS</a> or <a href="https://hyspeedblog.wordpress.com/2014/08/27/working-with-landsat-8-using-and-interpreting-the-quality-assessment-qa-band/" target="_blank" rel="noopener">L-LDOPE Toolbelt</a>. In this article, I am going to introduce how to use <em>pymasker</em> to generate masks from Landsat 8 QA band in Python. This package is designed to provide a straightforward and intuitive way to generate masks from the QA band. It is an open-source package and the project is hosted at <a href="https://github.com/dz316424/pymasker" target="_blank" rel="noopener">GitHub</a>.</p><h2 id="Installation"><a href="#Installation" class="headerlink" title="Installation"></a>Installation</h2><p>The package can be shipped to your computer using pip.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pymasker</span><br></pre></td></tr></table></figure><p>Or just install it with the source code.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python setup.py install</span><br></pre></td></tr></table></figure><p>This package depends on <a href="http://www.numpy.org/" target="_blank" rel="noopener"><strong>numpy</strong></a>. If you want to directly load the QA band file, <a href="https://pypi.python.org/pypi/GDAL/" target="_blank" rel="noopener"><strong>GDAL</strong></a> is also in need.</p><h2 id="Sample"><a href="#Sample" class="headerlink" title="Sample"></a>Sample</h2><p>First of all, you need to load the QA band into the <em>qabmaser</em> class.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pymasker <span class="keyword">import</span> LandsatMasker</span><br><span class="line"></span><br><span class="line"><span class="comment"># load the QA band directly</span></span><br><span class="line">masker = LandsatMasker(<span class="string">'LC80170302014272LGN00_BQA.TIF'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># load a numpy array that contains band data</span></span><br><span class="line">masker = LandsatMasker(bandarray)</span><br></pre></td></tr></table></figure><p>The QA band contains the detection result of the following four specific conditions for each pixel:</p><ul><li><p>Cloud</p></li><li><p>Cirrus</p></li><li><p>Snow/Ice</p></li><li><p>Vegetation</p></li><li><p>Water body</p></li></ul><p>For each condition, the algorithm gives a confidence to indicate its existence on the pixel.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pymasker <span class="keyword">import</span> LandsatConfidence</span><br><span class="line"></span><br><span class="line"><span class="comment"># Algorithm has high confidence that this condition exists (67-100 percent confidence).</span></span><br><span class="line">conf = LandsatConfidence.high</span><br><span class="line"></span><br><span class="line"><span class="comment"># Algorithm has medium confidence that this condition exists (34-66 percent confidence).</span></span><br><span class="line">conf = LandsatConfidence.medium</span><br><span class="line"></span><br><span class="line"><span class="comment"># Algorithm has low to no confidence that this condition exists (0-33 percent confidence)</span></span><br><span class="line">conf = LandsatConfidence.low</span><br><span class="line"></span><br><span class="line"><span class="comment"># Algorithm did not determine the status of this condition.</span></span><br><span class="line">conf = LandsatConfidence.undefined</span><br><span class="line"></span><br><span class="line"><span class="comment"># Nothing, unspecified confidence</span></span><br><span class="line">conf = LandsatConfidence.none</span><br></pre></td></tr></table></figure><p>To generate a mask, you need to define a desired confidence for the target condition.</p><p><em>Pymasker</em> provides several functions to get the most commonly used mask. The resulting mask is a binary numpy array with 1 representing existence of specific condition and 0 representing nonexistence.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Get mask indicating cloud pixels with high confidence</span></span><br><span class="line">mask = masker.get_cloud_mask(LandsatConfidence.high)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get mask indicating cloud pixels with at least medium confidence</span></span><br><span class="line">mask = masker.get_cloud_mask(LandsatConfidence.medium, cumulative = <span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get mask indicating snow/ice pixels with at least medium confidence</span></span><br><span class="line">mask = masker.get_snow_mask(LandsatConfidence.medium, cumulative = <span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get mask indicating water body pixels with high confidence</span></span><br><span class="line">mask = masker.get_water_mask(LandsatConfidence.high)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get mask indicating vegetation pixels with high confidence</span></span><br><span class="line">mask = masker.get_veg_mask(LandsatConfidence.high)</span><br></pre></td></tr></table></figure><p><em>Pymasker</em> also provides a function for multi-criteria masking. In this function, you need to specify the confidence level of each condition. If you don’t want the function consider one of conditions, you need to set it as confidence.none. Two different masking methods are provided:</p><ul><li><p>Inclusive - Mask pixels that meet at least one of all criteria.</p></li><li><p>Exclusive - Only Mask pixels that meet all criteria. (default)</p></li></ul><p>Sample code for multi-criteria masking</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Get mask indicating cloud pixels (high confidence) and cirrus pixels (high confidence).</span></span><br><span class="line"><span class="comment"># Exclusive and noncumulative</span></span><br><span class="line">mask = masker.get_multi_mask(cloud = LandsatConfidence.high, water = LandsatConfidence.high)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Save the result if you want.</span></span><br><span class="line">masker.save_tif(mask, <span class="string">'result.tif'</span>)</span><br></pre></td></tr></table></figure><p>Now you have your mask! Nice and quick!</p></div><div class="article-tags tags"><a href="/blog/tags/remote-sensing/">remote sensing</a> <a href="/blog/tags/landsat/">landsat</a> <a href="/blog/tags/python/">python</a></div><div class="art-item-footer"><span class="art-item-left"><i class="icon icon-chevron-thin-left"></i>prev：<a href="/blog/2015/01/22/Pymasker/" rel="prev" title="Pymasker"> Pymasker </a></span><span class="art-item-right">next：<a href="/blog/2014/09/17/ArcMap-Raster-Edit-Suite/" rel="next" title="ArcMap Raster Edit Suite"> ArcMap Raster Edit Suite </a><i class="icon icon-chevron-thin-right"></i></span></div></section><section id="comments"><div id="disqus_thread"></div></section></article><script>window.subData={title:"Making masks with Landsat 8 Quality Assessment band using Python",tools:!0}</script></div><aside class="l_side"><section class="m_widget about"><div class="header">Haoliang Yu</div><div class="content"><div class="desc">I am a software engineer at Esri DC R&amp;D, working on open data publication and discovery. I love to play with data, cloud computing, and distributed network. I also co-organize MaptimeBUF and speak at variou meetups/conferences.</div></div></section><section class="m_widget links"><div class="header">Links</div><div class="content"><ul class="entry"><li><a class="flat-box" target="_blank" href="https://github.com/haoliangyu"><div class="name">GitHub</div></a></li><li><a class="flat-box" target="_blank" href="https://www.linkedin.com/in/haoliangyu/"><div class="name">LinkedIn</div></a></li><li><a class="flat-box" target="_blank" href="http://dc.esri.com/"><div class="name">EsriDC</div></a></li></ul></div></section><section class="m_widget categories"><div class="header">Categories</div><div class="content"><ul class="entry"><li><a class="flat-box" href="/blog/categories/AWS/"><div class="name">AWS</div><div class="badget">1</div></a></li><li><a class="flat-box" href="/blog/categories/GIS/"><div class="name">GIS</div><div class="badget">14</div></a></li><li><a class="flat-box" href="/blog/categories/Life/"><div class="name">Life</div><div class="badget">1</div></a></li><li><a class="flat-box" href="/blog/categories/Open-Data/"><div class="name">Open Data</div><div class="badget">1</div></a></li><li><a class="flat-box" href="/blog/categories/Project/"><div class="name">Project</div><div class="badget">4</div></a></li></ul></div></section><div class="m_widget tagcloud"><div class="header">Tags</div><div class="content"><a href="/blog/tags/C/" style="font-size:14px;color:grey">C#</a> <a href="/blog/tags/OpenDataDiscovery-org/" style="font-size:15.2px;color:#666">OpenDataDiscovery.org</a> <a href="/blog/tags/arcgis/" style="font-size:18.8px;color:#1a1a1a">arcgis</a> <a href="/blog/tags/arcobject/" style="font-size:14px;color:grey">arcobject</a> <a href="/blog/tags/aws/" style="font-size:14px;color:grey">aws</a> <a href="/blog/tags/ci/" style="font-size:14px;color:grey">ci</a> <a href="/blog/tags/deloyment/" style="font-size:14px;color:grey">deloyment</a> <a href="/blog/tags/geojson/" style="font-size:15.2px;color:#666">geojson</a> <a href="/blog/tags/gis/" style="font-size:20px;color:#000">gis</a> <a href="/blog/tags/javascript/" style="font-size:15.2px;color:#666">javascript</a> <a href="/blog/tags/landsat/" style="font-size:15.2px;color:#666">landsat</a> <a href="/blog/tags/leaflet/" style="font-size:16.4px;color:#4d4d4d">leaflet</a> <a href="/blog/tags/modis/" style="font-size:14px;color:grey">modis</a> <a href="/blog/tags/open-data/" style="font-size:17.6px;color:#333">open data</a> <a href="/blog/tags/openstreetmap/" style="font-size:14px;color:grey">openstreetmap</a> <a href="/blog/tags/project/" style="font-size:16.4px;color:#4d4d4d">project</a> <a href="/blog/tags/python/" style="font-size:16.4px;color:#4d4d4d">python</a> <a href="/blog/tags/remote-sensing/" style="font-size:17.6px;color:#333">remote sensing</a> <a href="/blog/tags/typescript/" style="font-size:16.4px;color:#4d4d4d">typescript</a></div></div></aside><script>setLoadingBarProgress(60)</script></div></div><footer id="footer" class="clearfix"><div class="social-wrapper"><a href="https://github.com/haoliangyu" class="social github" target="_blank" rel="external"><span class="icon icon-github"></span> </a><a href="/atom.xml" class="social rss" target="_blank" rel="external"><span class="icon icon-rss"></span></a></div><div>A blog built by Haoliang Yu</div></footer><script>setLoadingBarProgress(80)</script><script>var disqus_shortname="dz316424",disqus_url="http://haoliangyu.github.io/blog/2015/01/19/Making-masks-with-Landsat-8-Quality-Assessment-band-using-Python/";!function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.src="//"+disqus_shortname+".disqus.com/embed.js",(document.getElementsByTagName("head")[0]||document.getElementsByTagName("body")[0]).appendChild(e)}()</script><script src="//apps.bdimg.com/libs/jquery/2.1.4/jquery.min.js"></script><script src="//cdn.bootcss.com/node-waves/0.7.5/waves.min.js"></script><script src="//cdn.bootcss.com/scrollReveal.js/3.3.2/scrollreveal.min.js"></script><script src="/blog/js/jquery.fitvids.js"></script><script>var GOOGLE_CUSTOM_SEARCH_API_KEY="",GOOGLE_CUSTOM_SEARCH_ENGINE_ID="",ALGOLIA_API_KEY="",ALGOLIA_APP_ID="",ALGOLIA_INDEX_NAME="",AZURE_SERVICE_NAME="",AZURE_INDEX_NAME="",AZURE_QUERY_KEY="",BAIDU_API_ID="",SEARCH_SERVICE="hexo",ROOT="/blog/";ROOT.endsWith("/")||(ROOT+="/")</script><script src="/blog/js/search.js"></script><script src="/blog/js/app.js"></script><script>setLoadingBarProgress(100)</script></body>