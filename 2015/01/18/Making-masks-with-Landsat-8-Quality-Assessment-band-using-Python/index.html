
<!DOCTYPE html>
<html lang="null">
    
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="HaoliangYu.io">
    <title>Making masks with Landsat 8 Quality Assessment band using Python - HaoliangYu.io</title>
    <meta name="author" content="Haoliang Yu">
    
    
    <meta name="description" content="Notice: Since 0.2.0, the qabmasker has been renamed as landsatmasker and the function getmask has been renamed as getmultimask for better identification. Please update your script accordingly.
The Qua">
<meta property="og:type" content="blog">
<meta property="og:title" content="Making masks with Landsat 8 Quality Assessment band using Python">
<meta property="og:url" content="http://yoursite.com/2015/01/18/Making-masks-with-Landsat-8-Quality-Assessment-band-using-Python/index.html">
<meta property="og:site_name" content="HaoliangYu.io">
<meta property="og:description" content="Notice: Since 0.2.0, the qabmasker has been renamed as landsatmasker and the function getmask has been renamed as getmultimask for better identification. Please update your script accordingly.
The Qua">
<meta property="og:image" content="http://yoursite.com/2015/01/18/Making-masks-with-Landsat-8-Quality-Assessment-band-using-Python/maskresult.png">
<meta property="og:updated_time" content="2016-02-25T05:53:25.934Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Making masks with Landsat 8 Quality Assessment band using Python">
<meta name="twitter:description" content="Notice: Since 0.2.0, the qabmasker has been renamed as landsatmasker and the function getmask has been renamed as getmultimask for better identification. Please update your script accordingly.
The Qua">
    
    
    
    
    
    
    <!--STYLES-->
    <link rel="stylesheet" href="/assets/css/style.min.css" type="text/css">
    <!--STYLES END-->
    
    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-55804436-1']);
        _gaq.push(['_trackPageview']);
        (function() {
            var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
            ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
            var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();
    </script>

</head>

    <body>
        <div id="blog">
            <!-- Define author's picture -->


    

<header id="header" data-behavior="3">
    <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
    <h1 class="header-title">
        <a class="header-title-link" href="/ ">HaoliangYu.io</a>
    </h1>
    
        
            <a  class="header-right-picture "
                href="/#about">
        
        
        </a>
    
</header>

            <!-- Define author's picture -->


<nav id="sidebar" data-behavior="3">
    
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/ "
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-home"></i>
                    <span class="sidebar-button-desc">Home</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-categories"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
                    <span class="sidebar-button-desc">Categories</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-tags"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
                    <span class="sidebar-button-desc">Tags</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/all-archives"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
                    <span class="sidebar-button-desc">Archives</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link "
                         href="/#about"
                        
                    >
                
                    <i class="sidebar-button-icon fa fa-lg fa-question"></i>
                    <span class="sidebar-button-desc">About Me</span>
                </a>
        </li>
        
    </ul>
    
        <ul class="sidebar-buttons">
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="https://github.com/haoliangyu" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-github"></i>
                    <span class="sidebar-button-desc">GitHub</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="https://www.linkedin.com/in/haoliangyu" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-linkedin"></i>
                    <span class="sidebar-button-desc">LinkedIn</span>
                </a>
        </li>
        
            <li class="sidebar-button">
                
                    <a  class="sidebar-button-link " href="mailto:haoliang.yu@outlook.com" target="_blank">
                
                    <i class="sidebar-button-icon fa fa-lg fa-envelope-o"></i>
                    <span class="sidebar-button-desc">Mail</span>
                </a>
        </li>
        
    </ul>
    
</nav>

            
            <div id="main" data-behavior="3"
                 class="
                        hasCoverMetaIn
                        ">
                
<article class="post" itemscope itemType="http://schema.org/BlogPosting">
    
    
        <div class="post-header main-content-wrap text-left">
    
        <h1 class="post-title" itemprop="headline">
            Making masks with Landsat 8 Quality Assessment band using Python
        </h1>
    
    <div class="post-meta">
    <time itemprop="datePublished" content="Sun Jan 18 2015 21:13:06 GMT-0500">
	
		    18 Jan 2015
    	
    </time>
    
        <span>dans </span>
        
    <a class="category-link" href="/categories/GIS/">GIS</a>


    
</div>
</div>
    
    <div class="post-content markdown" itemprop="articleBody">
        <div class="main-content-wrap">
            <p><strong>Notice:</strong> Since 0.2.0, the <em>qabmasker</em> has been renamed as <em>landsatmasker</em> and the function <em>getmask</em> has been renamed as <em>getmultimask</em> for better identification. Please update your script accordingly.</p>
<p>The Quality Assessment (QA) band is a standard product included in each Landsat 8 image downloaded from USGS, which contains the quality information of each pixel such as cloud, snow/ice, water body etc. The detailed information of this band can be found at <a href="http://landsat.usgs.gov/L8QualityAssessmentBand.php" target="_blank" rel="external">Landsat 8 Quality Assessment Band</a>.<br><a id="more"></a><br>Although the bits structure of the QA band is easy-to-understand, it would several steps to extract the desired mask in <a href="http://courses.neteler.org/processing-landsat8-data-in-grass-gis-7/" target="_blank" rel="external">QGIS</a> or <a href="https://hyspeedblog.wordpress.com/2014/08/27/working-with-landsat-8-using-and-interpreting-the-quality-assessment-qa-band/" target="_blank" rel="external">L-LDOPE Toolbelt</a>. In this article, I am going to introduce how to use <em>pymasker</em> to generate masks from Landsat 8 QA band in Python. This package is designed to provide a straightforward and intuitive way to generate masks from the QA band. It is an open-source package and the project is hosted at <a href="https://github.com/dz316424/pymasker" target="_blank" rel="external">GitHub</a>.</p>
<h2 id="Installation">Installation</h2><p>The package can be shipped to your computer using pip.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install pymasker</span><br></pre></td></tr></table></figure>
<p>Or just install it with the source code.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">python setup.py install</span><br></pre></td></tr></table></figure>
<p>This package depends on <a href="http://www.numpy.org/" target="_blank" rel="external"><strong>numpy</strong></a>. If you want to directly load the QA band file, <a href="https://pypi.python.org/pypi/GDAL/" target="_blank" rel="external"><strong>GDAL</strong></a> is also in need.</p>
<h2 id="Sample">Sample</h2><p>First of all, you need to load the QA band into the <em>qabmaser</em> class.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pymasker <span class="keyword">import</span> landsatmasker</span><br><span class="line"></span><br><span class="line"><span class="comment"># load the QA band directly</span></span><br><span class="line">masker = landsatmasker(<span class="string">'LC80170302014272LGN00_BQA.TIF'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># load a numpy array that contains band data</span></span><br><span class="line">masker = landsatmasker(bandarray)</span><br></pre></td></tr></table></figure>
<p>The QA band contains the detection result of the following four specific conditions for each pixel:</p>
<ul>
<li><p>Cloud</p>
</li>
<li><p>Cirrus</p>
</li>
<li><p>Snow/Ice</p>
</li>
<li><p>Vegetation</p>
</li>
<li><p>Water body</p>
</li>
</ul>
<p>For each condition, the algorithm gives a confidence to indicate its existence on the pixel.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pymasker <span class="keyword">import</span> confidence</span><br><span class="line"></span><br><span class="line"><span class="comment"># Algorithm has high confidence that this condition exists (67-100 percent confidence).</span></span><br><span class="line">conf = confidence.high</span><br><span class="line"></span><br><span class="line"><span class="comment"># Algorithm has medium confidence that this condition exists (34-66 percent confidence).</span></span><br><span class="line">conf = confidence.medium</span><br><span class="line"></span><br><span class="line"><span class="comment"># Algorithm has low to no confidence that this condition exists (0-33 percent confidence)</span></span><br><span class="line">conf = confidence.low</span><br><span class="line"></span><br><span class="line"><span class="comment"># Algorithm did not determine the status of this condition.</span></span><br><span class="line">conf = confidence.undefined</span><br><span class="line"></span><br><span class="line"><span class="comment"># Nothing, unspecified confidence</span></span><br><span class="line">conf = confidence.none</span><br></pre></td></tr></table></figure>
<p>To generate a mask, you need to define a desired confidence for the target condition.</p>
<p><em>Pymasker</em> provides several functions to get the most commonly used mask. The resulting mask is a binary numpy array with 1 representing existence of specific condition and 0 representing nonexistence.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Get mask indicating cloud pixels with high confidence</span></span><br><span class="line"><span class="comment"># (excluding cirrus)</span></span><br><span class="line">mask = masker.getcloudmask(confidence.high)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get mask indicating cloud pixels with high confidence</span></span><br><span class="line"><span class="comment"># (including cirrus)</span></span><br><span class="line">mask = masker.getcloudmask(confidence.high, cirrus = <span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get mask indicating cloud pixels with at least medium confidence</span></span><br><span class="line"><span class="comment"># (including cirrus)</span></span><br><span class="line">mask = masker.getcloudmask(confidence.medium, cirrus = <span class="keyword">True</span>, cumulative = <span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get mask indicating snow/ice pixels with at least medium confidence</span></span><br><span class="line">mask = masker.getsnowmask(confidence.medium, cumulative = <span class="keyword">True</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get mask indicating water body pixels with high confidence</span></span><br><span class="line">mask = masker.getwatermask(confidence.high)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Get mask indicating vegetation pixels with high confidence</span></span><br><span class="line">mask = masker.getvegmask(confidence.high)</span><br></pre></td></tr></table></figure>
<p><em>Pymasker</em> also provides a function for multi-criteria masking. In this function, you need to specify the confidence level of each condition. If you don’t want the function consider one of conditions, you need to set it as confidence.none. Two different masking methods are provided:</p>
<ul>
<li><p>Inclusive    -    Mask pixels that meet at least one of all criteria.</p>
</li>
<li><p>Exclusive -    Only Mask pixels that meet all criteria. (default)</p>
</li>
</ul>
<p>Sample code for multi-criteria masking</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Get mask indicating cloud pixels (high confidence) and cirrus pixels (high confidence).</span></span><br><span class="line"><span class="comment"># Exclusive and noncumulative</span></span><br><span class="line">mask = masker.getmultimask(cloud = confidence.high, cirrus = confidence.high)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Save the result if you want.</span></span><br><span class="line">masker.savetif(mask, <span class="string">'result.tif'</span>)</span><br></pre></td></tr></table></figure>
<img src="/2015/01/18/Making-masks-with-Landsat-8-Quality-Assessment-band-using-Python/maskresult.png" alt="This is an example image" title="This is an example image">
<p>Now you have your mask! Nice and quick!</p>

            
                

            
        </div>
    </div>
    <div id="post-footer" class="post-footer main-content-wrap">
        
            <div class="post-footer-tags">
                <span class="text-color-light text-small">TAGGÉ DANS</span><br/>
                
    <a class="tag tag--primary tag--small t-link" href="/tags/landsat/">landsat</a> <a class="tag tag--primary tag--small t-link" href="/tags/python/">python</a> <a class="tag tag--primary tag--small t-link" href="/tags/remote-sensing/">remote sensing</a>

            </div>
        
        <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2015/01/21/Pymasker/"  data-tooltip="Pymasker">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PRÉCÉDENT</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2014/09/17/ArcMap-Raster-Edit-Suite/" data-tooltip="ArcMap Raster Edit Suite">
                
                    <span class="hide-xs hide-sm text-small icon-mr">SUIVANT</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://yoursite.com/2015/01/18/Making-masks-with-Landsat-8-Quality-Assessment-band-using-Python/">
                <i class="fa fa-google-plus"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://yoursite.com/2015/01/18/Making-masks-with-Landsat-8-Quality-Assessment-band-using-Python/">
                <i class="fa fa-facebook-official"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://yoursite.com/2015/01/18/Making-masks-with-Landsat-8-Quality-Assessment-band-using-Python/">
                <i class="fa fa-twitter"></i>
            </a>
        </li>
        
            <li class="post-action">
                <a class="post-action-btn btn btn--default" href="#disqus_thread">
                    <i class="fa fa-comment-o"></i>
                </a>
            </li>
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>


        
            <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
        
    </div>
</article>



                <footer id="footer" class="main-content-wrap">
    <span class="copyrights">
        Copyrights &copy; 2016 Haoliang Yu. All Rights Reserved.
    </span>
</footer>

            </div>
            
                <div id="bottom-bar" class="post-bottom-bar" data-behavior="3">
                    <div class="post-actions-wrap">
    <nav>
        <ul class="post-actions post-action-nav">
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2015/01/21/Pymasker/"  data-tooltip="Pymasker">
                
                    <i class="fa fa-angle-left"></i>
                    <span class="hide-xs hide-sm text-small icon-ml">PRÉCÉDENT</span>
                </a>
            </li>
            <li class="post-action">
                
                    <a class="post-action-btn btn btn--default tooltip--top" href="/2014/09/17/ArcMap-Raster-Edit-Suite/" data-tooltip="ArcMap Raster Edit Suite">
                
                    <span class="hide-xs hide-sm text-small icon-mr">SUIVANT</span>
                    <i class="fa fa-angle-right"></i>
                </a>
            </li>
        </ul>
    </nav>
    <ul class="post-actions post-action-share">
        <li class="post-action hide-lg hide-md hide-sm">
            <a class="post-action-btn btn btn--default btn-open-shareoptions"  href="#btn-open-shareoptions">
                <i class="fa fa-share-alt"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=http://yoursite.com/2015/01/18/Making-masks-with-Landsat-8-Quality-Assessment-band-using-Python/">
                <i class="fa fa-google-plus"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://yoursite.com/2015/01/18/Making-masks-with-Landsat-8-Quality-Assessment-band-using-Python/">
                <i class="fa fa-facebook-official"></i>
            </a>
        </li>
        <li class="post-action hide-xs">
            <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=http://yoursite.com/2015/01/18/Making-masks-with-Landsat-8-Quality-Assessment-band-using-Python/">
                <i class="fa fa-twitter"></i>
            </a>
        </li>
        
            <li class="post-action">
                <a class="post-action-btn btn btn--default" href="#disqus_thread">
                    <i class="fa fa-comment-o"></i>
                </a>
            </li>
        
        <li class="post-action">
            
                <a class="post-action-btn btn btn--default" href="#">
            
                <i class="fa fa-list"></i>
            </a>
        </li>
    </ul>
</div>


                </div>
                <div id="share-options-bar" class="share-options-bar" data-behavior="3">
    <ul class="share-options">
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=http://yoursite.com/2015/01/18/Making-masks-with-Landsat-8-Quality-Assessment-band-using-Python/">
                <i class="fa fa-google-plus"></i><span class="">Partager sur Google Plus</span>
            </a>
        </li>
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=http://yoursite.com/2015/01/18/Making-masks-with-Landsat-8-Quality-Assessment-band-using-Python/">
                <i class="fa fa-facebook-official"></i><span>Partager sur Facebook</span>
            </a>
        </li>
        <li class="share-option">
            <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=http://yoursite.com/2015/01/18/Making-masks-with-Landsat-8-Quality-Assessment-band-using-Python/">
                <i class="fa fa-twitter"></i><span>Partager sur Twitter</span>
            </a>
        </li>
    </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
            
        </div>
        <!-- Define author's picture -->


<div id="about">
    <div id="about-card">
        <div id="about-btn-close">
            <i class="fa fa-remove"></i>
        </div>
        
            <h4 id="about-card-name">Haoliang Yu</h4>
        
            <h5 id="about-card-bio">
              a lover to map, a participant to open-source software, an advocate for open data
              <!-- <p>author.bio</p>
 -->
            </h5>
        
        
            <h5 id="about-card-job">
                <i class="fa fa-briefcase"></i>
                <br/>
                Full-Stask GIS Developper
                <!-- <p>author.job</p>
 -->
            </h5>
        
        
            <h5 id="about-card-location">
                <i class="fa fa-map-marker"></i>
                <br/>
                Buffalo, NY
            </h5>
        
    </div>
</div>

        
<div id="cover" style="background-image:url('/assets/images/cover.jpg');"></div>
    </body>
    <!--SCRIPTS-->
<script src="/assets/js/script.min.js" type="text/javascript"></script>
<!--SCRIPTS END-->

    <script type="text/javascript">
        var disqus_shortname = 'dz316424';
        (function() {
            var dsq = document.createElement('script');
            dsq.type = 'text/javascript';
            dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>



</html>
