<!DOCTYPE html><html><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#222"><meta http-equiv="X-UA-Compatible" content="IE=edge"><link rel="apple-touch-icon" sizes="180x180" href="/blog/images/apple-touch-icon-next.png?v=7.3.0"><link rel="icon" type="image/png" sizes="32x32" href="/blog/images/favicon-32x32-next.png?v=7.3.0"><link rel="icon" type="image/png" sizes="16x16" href="/blog/images/favicon-16x16-next.png?v=7.3.0"><link rel="mask-icon" href="/blog/images/logo.svg?v=7.3.0" color="#222"><link rel="stylesheet" href="/blog/css/main.css?v=7.3.0"><link rel="stylesheet" href="/blog/lib/font-awesome/css/font-awesome.min.css?v=4.7.0"><script id="hexo-configurations">var NexT=window.NexT||{},CONFIG={root:"/blog/",scheme:"Muse",version:"7.3.0",exturl:!1,sidebar:{position:"left",display:"post",offset:12,onmobile:!1},copycode:{enable:!1,show_result:!1,style:null},back2top:{enable:!0,sidebar:!1,scrollpercent:!1},bookmark:{enable:!1,color:"#222",save:"auto"},fancybox:!1,mediumzoom:!1,lazyload:!1,pangu:!1,algolia:{appID:"",apiKey:"",indexName:"",hits:{per_page:10},labels:{input_placeholder:"Search for Posts",hits_empty:"We didn't find any results for the search: ${query}",hits_stats:"${hits} results found in ${time} ms"}},localsearch:{enable:!0,trigger:"auto",top_n_per_article:1,unescape:!1,preload:!1},path:"search.xml",motion:{enable:!0,async:!1,transition:{post_block:"fadeIn",post_header:"slideDownIn",post_body:"slideDownIn",coll_header:"slideLeftIn",sidebar:"slideUpIn"}},translation:{copy_button:"Copy",copy_success:"Copied",copy_failure:"Copy failed"}}</script><meta name="description" content="Update Since 0.3.0, most class and function names have been updated according to pep8.Days ago when I published the first version of pymasker for masking Landsat 8 image, Dr. Robert A. Washington-Alle"><meta name="keywords" content="remote sensing,modis,python"><meta property="og:type" content="article"><meta property="og:title" content="Making masks from Quality Control bits of MODIS land products in Python (Update)"><meta property="og:url" content="http://haoliangyu.github.io/blog/2015/02/19/Making-masks-from-Quality-Control-bits-of-MODIS-land-products-in-Python-Update/index.html"><meta property="og:site_name" content="Joe&#39;s Talk"><meta property="og:description" content="Update Since 0.3.0, most class and function names have been updated according to pep8.Days ago when I published the first version of pymasker for masking Landsat 8 image, Dr. Robert A. Washington-Alle"><meta property="og:locale" content="default"><meta property="og:image" content="http://haoliangyu.github.io/blog/2015/02/19/Making-masks-from-Quality-Control-bits-of-MODIS-land-products-in-Python-Update/bitstructure.png"><meta property="og:image" content="http://haoliangyu.github.io/blog/2015/02/19/Making-masks-from-Quality-Control-bits-of-MODIS-land-products-in-Python-Update/bittable.png"><meta property="og:image" content="http://haoliangyu.github.io/blog/2015/02/19/Making-masks-from-Quality-Control-bits-of-MODIS-land-products-in-Python-Update/bitsample.png"><meta property="og:image" content="http://haoliangyu.github.io/blog/2015/02/19/Making-masks-from-Quality-Control-bits-of-MODIS-land-products-in-Python-Update/hqmask.png"><meta property="og:updated_time" content="2019-08-27T16:55:59.504Z"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Making masks from Quality Control bits of MODIS land products in Python (Update)"><meta name="twitter:description" content="Update Since 0.3.0, most class and function names have been updated according to pep8.Days ago when I published the first version of pymasker for masking Landsat 8 image, Dr. Robert A. Washington-Alle"><meta name="twitter:image" content="http://haoliangyu.github.io/blog/2015/02/19/Making-masks-from-Quality-Control-bits-of-MODIS-land-products-in-Python-Update/bitstructure.png"><link rel="alternate" href="/blog/atom.xml" title="Joe's Talk" type="application/atom+xml"><link rel="canonical" href="http://haoliangyu.github.io/blog/2015/02/19/Making-masks-from-Quality-Control-bits-of-MODIS-land-products-in-Python-Update/"><script id="page-configurations">CONFIG.page={sidebar:"",isHome:!1,isPost:!0,isPage:!1,isArchive:!1}</script><title>Making masks from Quality Control bits of MODIS land products in Python (Update) | Joe's Talk</title><meta name="generator" content="Hexo 3.9.0"><noscript><style>.sidebar-inner,.use-motion .brand,.use-motion .collection-header,.use-motion .comments,.use-motion .menu-item,.use-motion .pagination,.use-motion .post-block,.use-motion .post-body,.use-motion .post-header{opacity:initial}.use-motion .logo,.use-motion .site-subtitle,.use-motion .site-title{opacity:initial;top:initial}.use-motion .logo-line-before i{left:initial}.use-motion .logo-line-after i{right:initial}</style></noscript></head><body itemscope itemtype="http://schema.org/WebPage" lang="default"><div class="container use-motion"><div class="headband"></div><header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="header-inner"><div class="site-brand-container"><div class="site-meta"><div><a href="/blog/" class="brand" rel="start"><span class="logo-line-before"><i></i></span> <span class="site-title">Joe's Talk</span> <span class="logo-line-after"><i></i></span></a></div></div><div class="site-nav-toggle"><button aria-label="Toggle navigation bar"><span class="btn-bar"></span> <span class="btn-bar"></span> <span class="btn-bar"></span></button></div></div><nav class="site-nav"><ul id="menu" class="menu"><li class="menu-item menu-item-home"><a href="/blog/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i><br>Home</a></li><li class="menu-item menu-item-categories"><a href="/blog/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i><br>Categories</a></li><li class="menu-item menu-item-archives"><a href="/blog/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i><br>Archives</a></li><li class="menu-item menu-item-search"><a href="javascript:;" class="popup-trigger"><i class="menu-item-icon fa fa-search fa-fw"></i><br>Search</a></li></ul></nav><div class="site-search"><div class="popup search-popup"><div class="search-header"><span class="search-icon"><i class="fa fa-search"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="none" placeholder="Searching..." spellcheck="false" type="text" id="search-input"></div><span class="popup-btn-close"><i class="fa fa-times-circle"></i></span></div><div id="search-result"></div></div><div class="search-pop-overlay"></div></div></div></header><div class="back-to-top"><i class="fa fa-arrow-up"></i> <span>0%</span></div><main id="main" class="main"><div class="main-inner"><div class="content-wrap"><div id="content" class="content"><div id="posts" class="posts-expand"><article itemscope itemtype="http://schema.org/Article"><div class="post-block post"><link itemprop="mainEntityOfPage" href="http://haoliangyu.github.io/blog/blog/2015/02/19/Making-masks-from-Quality-Control-bits-of-MODIS-land-products-in-Python-Update/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="name" content="Haoliang Yu"><meta itemprop="description" content=""><meta itemprop="image" content="/blog/images/avatar.gif"></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="Joe's Talk"></span><header class="post-header"><h2 class="post-title" itemprop="name headline">Making masks from Quality Control bits of MODIS land products in Python (Update)</h2><div class="post-meta"><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-o"></i> </span><span class="post-meta-item-text">Posted on</span> <time title="Created: 2015-02-19 21:23:29" itemprop="dateCreated datePublished" datetime="2015-02-19T21:23:29+00:00">2015-02-19</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-calendar-check-o"></i> </span><span class="post-meta-item-text">Edited on</span> <time title="Modified: 2019-08-27 16:55:59" itemprop="dateModified" datetime="2019-08-27T16:55:59+00:00">2019-08-27</time> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-folder-o"></i> </span><span class="post-meta-item-text">In</span> <span itemprop="about" itemscope itemtype="http://schema.org/Thing"><a href="/blog/categories/GIS/" itemprop="url" rel="index"><span itemprop="name">GIS</span></a></span> </span><span class="post-meta-item"><span class="post-meta-item-icon"><i class="fa fa-comment-o"></i> </span><span class="post-meta-item-text">Disqus: </span><a title="disqus" href="/blog/2015/02/19/Making-masks-from-Quality-Control-bits-of-MODIS-land-products-in-Python-Update/#comments" itemprop="discussionUrl"><span class="post-comments-count disqus-comment-count" data-disqus-identifier="2015/02/19/Making-masks-from-Quality-Control-bits-of-MODIS-land-products-in-Python-Update/" itemprop="commentCount"></span></a></span></div></header><div class="post-body" itemprop="articleBody"><p><strong>Update</strong> Since 0.3.0, most class and function names have been updated according to pep8.</p><p>Days ago when I published the first version of <em><a href="https://github.com/haoliangyu/pymasker" target="_blank" rel="noopener">pymasker</a></em> for masking Landsat 8 image, Dr. Robert A. Washington-Allen suggested me whether the package would be used for MODIS products. After I read technical documents of MODIS, I realize that the Quality Control bits of MOIDS products has the same structure as the QA band of Landsat 8. Therefore, I update the package to adapt MODIS products (or other NASA products with similar QC/QA bits).</p><a id="more"></a><p>In this article, I am going to show how to extract masks from the Quality Control bits of MODIS land product in python.</p><h2 id="MODIS-QC-QA-bits"><a href="#MODIS-QC-QA-bits" class="headerlink" title="MODIS QC/QA bits"></a>MODIS QC/QA bits</h2><hr><p>The QC/QA bits of MODIS is a binary number, of which each section represents the state of certain condition. Just take the 250m resolution land surface reflectance product (MOD09GQ) as example. The QC band (maybe called QA band in other products) is the fourth band of the HDF dataset. It is a unsigned 16-bit band. Each value on the pixel indicates a combination of pixel conditions. We can interpret the value by separating its binary form.</p><img src="/blog/2015/02/19/Making-masks-from-Quality-Control-bits-of-MODIS-land-products-in-Python-Update/bitstructure.png" title="This is an example image"><p>The individual bits within a binary number are read from let to right as described in the following table.</p><img src="/blog/2015/02/19/Making-masks-from-Quality-Control-bits-of-MODIS-land-products-in-Python-Update/bittable.png" title="This is an example image"><p>Therefore when we put the interpretation back to the bit string, we are able to know what it indicates.</p><img src="/blog/2015/02/19/Making-masks-from-Quality-Control-bits-of-MODIS-land-products-in-Python-Update/bitsample.png" title="This is an example image"><p>As this binary number is 4096 in integer, all pixels having value 4096 in the QC band are high quality and cloud free with atmosphere correction, but no adjacency correction.</p><p>The structure of QC/QA bits vary in different MODISO products and different data collection. For full detail for each product, please have a look at</p><ul><li><a href="https://lpdaac.usgs.gov/products/modis_products_table" target="_blank" rel="noopener">MODIS Land Products QA Tutorial</a></li></ul><p>In the next sections, I will show how to make masks based on the QC/QA bits in python.</p><h2 id="Preparation"><a href="#Preparation" class="headerlink" title="Preparation"></a>Preparation</h2><hr><p>Before getting started, you need to do the following preparations:</p><ul><li><p>Download and install <strong><a href="https://github.com/haoliangyu/pymasker" target="_blank" rel="noopener">pymasker</a></strong>.</p></li><li><p>Know the band number of QC/QA band in your HDF dataset.</p></li><li><p>Know the QC/QA bit structure of your dataset. If you only want the mask of quality level, you don’t have to know the bit structure. Please go bottom and read the new update.</p></li></ul><h2 id="Maksing-for-MODIS-product"><a href="#Maksing-for-MODIS-product" class="headerlink" title="Maksing for MODIS product"></a>Maksing for MODIS product</h2><hr><p>I will continue to use MOD09GQ in the sample. First you need to load the QC Band</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pymasker <span class="keyword">import</span> Masker</span><br><span class="line"></span><br><span class="line"><span class="comment"># Directly load from file, require GDAL (3 is the QA band number)</span></span><br><span class="line">masker = Masker(<span class="string">'MOD09GQ.A2015025.h12v04.005.2015027064556.hdf'</span>, <span class="number">3</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Or you just load the dataset somewhere and get the band data as numpy array</span></span><br><span class="line"><span class="keyword">import</span> gdal</span><br><span class="line"></span><br><span class="line">hdfdataset = gdal.Open(<span class="string">'MOD09GQ.A2015025.h12v04.005.2015027064556.hdf'</span>)</span><br><span class="line">subdataset = hdfdataset.GetSubDatasets()[<span class="number">3</span>][<span class="number">0</span>]</span><br><span class="line">bandarray = gdal.Open(subdataset).ReadAsArray()</span><br><span class="line"></span><br><span class="line">masker = Masker(bandarray)</span><br></pre></td></tr></tbody></table></figure><p>You need to know the bit information to generate certain masks. For example, we want a mask only wit high quality pixels. In the previous section we have known that the quality bits start at the beginning (position 0) and the length is 2. We also know that <em>‘00’</em> indicate corrected product produced at ideal quality in all bands. Therefore, the high quality mask could be made with</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Get high quality mask</span></span><br><span class="line">mask = modismasker.ge_tmask(bitpos = <span class="number">0</span>, bitlen = <span class="number">2</span>, value = <span class="string">'00'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># Save the mask as a TIF file</span></span><br><span class="line">masker.save_tif(hqmask, <span class="string">'result.tif'</span>)</span><br></pre></td></tr></tbody></table></figure><p>Then you can get a binary mask where 1 represents the high quality pixel.</p><img src="/blog/2015/02/19/Making-masks-from-Quality-Control-bits-of-MODIS-land-products-in-Python-Update/hqmask.png" title="This is an example image"><h2 id="Update"><a href="#Update" class="headerlink" title="Update"></a>Update</h2><p><em>Pyamsker</em> has provided a new class for producing QA mask since version 0.2.2. So you don’t have to look for and remember those binary bits (Well I don’t like them, too).</p><p>I have wrapped quality levels for MODIS land products.</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pymasker <span class="keyword">import</span> ModisQuality</span><br><span class="line"></span><br><span class="line"><span class="comment"># Corrected product produced at ideal quality for all bands.</span></span><br><span class="line">quality = ModisQuality.high</span><br><span class="line"></span><br><span class="line"><span class="comment"># Corrected product produced at less than ideal quality for some or all bands.</span></span><br><span class="line">quality = ModisQuality.medium</span><br><span class="line"></span><br><span class="line"><span class="comment"># Corrected product not produced due to some reasons for some or all bands.</span></span><br><span class="line">quality = ModisQuality.low</span><br><span class="line"></span><br><span class="line"><span class="comment"># Corrected product not produced due to cloud effects for all bands.</span></span><br><span class="line">quality = ModisQuality.low_cloud</span><br></pre></td></tr></tbody></table></figure><p>Therefore, the masking code would be very intuitive and readable.</p><figure class="highlight python"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Create a MODIS QA masker, similar to creating a masker above</span></span><br><span class="line"><span class="keyword">from</span> pymasker <span class="keyword">import</span> ModisMasker</span><br><span class="line"></span><br><span class="line">masker = ModisMasker(<span class="string">'MOD09GQ.A2015025.h12v04.005.2015027064556.hdf'</span>)</span><br><span class="line">mask = masker.get_qa_mask(ModisQuality.high)</span><br></pre></td></tr></tbody></table></figure><p>I am going to gradually support all MODIS products in the future release. Please look forward to my new update :)</p><script>document.querySelectorAll('.github-emoji')
          .forEach(el => {
            if (!el.dataset.src) { return; }
            const img = document.createElement('img');
            img.style = 'display:none !important;';
            img.src = el.dataset.src;
            img.addEventListener('error', () => {
              img.remove();
              el.style.color = 'inherit';
              el.style.backgroundImage = 'none';
              el.style.background = 'none';
            });
            img.addEventListener('load', () => {
              img.remove();
            });
            document.body.appendChild(img);
          });</script></div><footer class="post-footer"><div class="post-tags"><a href="/blog/tags/remote-sensing/" rel="tag"># remote sensing</a> <a href="/blog/tags/modis/" rel="tag"># modis</a> <a href="/blog/tags/python/" rel="tag"># python</a></div><div class="post-nav"><div class="post-nav-next post-nav-item"><a href="/blog/2015/02/17/Editing-single-pixels-of-raster-layer-in-ArcMap-with-just-a-few-clicks/" rel="next" title="Editing single pixels of raster layer in ArcMap with just a few clicks"><i class="fa fa-chevron-left"></i> Editing single pixels of raster layer in ArcMap with just a few clicks</a></div><span class="post-nav-divider"></span><div class="post-nav-prev post-nav-item"><a href="/blog/2015/03/11/Yet-another-way-to-edit-your-raster-layer-in-ArcMap-Paint-on-it/" rel="prev" title="Yet another way to edit your raster layer in ArcMap - Paint on it!">Yet another way to edit your raster layer in ArcMap - Paint on it! <i class="fa fa-chevron-right"></i></a></div></div></footer></div></article></div></div><div class="comments" id="comments"><div id="disqus_thread"><noscript>Please enable JavaScript to view the comments powered by Disqus.</noscript></div></div></div><div class="sidebar-toggle"><div class="sidebar-toggle-line-wrap"><span class="sidebar-toggle-line sidebar-toggle-line-first"></span> <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span> <span class="sidebar-toggle-line sidebar-toggle-line-last"></span></div></div><aside class="sidebar"><div class="sidebar-inner"><ul class="sidebar-nav motion-element"><li class="sidebar-nav-toc" data-target="post-toc-wrap">Table of Contents</li><li class="sidebar-nav-overview" data-target="site-overview-wrap">Overview</li></ul><div class="post-toc-wrap sidebar-panel"><div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#MODIS-QC-QA-bits"><span class="nav-number">1.</span> <span class="nav-text">MODIS QC/QA bits</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Preparation"><span class="nav-number">2.</span> <span class="nav-text">Preparation</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Maksing-for-MODIS-product"><span class="nav-number">3.</span> <span class="nav-text">Maksing for MODIS product</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Update"><span class="nav-number">4.</span> <span class="nav-text">Update</span></a></li></ol></div></div><div class="site-overview-wrap sidebar-panel"><div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person"><p class="site-author-name" itemprop="name">Haoliang Yu</p><div class="site-description" itemprop="description"></div></div><nav class="site-state motion-element"><div class="site-state-item site-state-posts"><a href="/blog/archives/"><span class="site-state-item-count">22</span> <span class="site-state-item-name">posts</span></a></div><div class="site-state-item site-state-categories"><span class="site-state-item-count">6</span> <span class="site-state-item-name">categories</span></div><div class="site-state-item site-state-tags"><span class="site-state-item-count">20</span> <span class="site-state-item-name">tags</span></div></nav><div class="feed-link motion-element"><a href="/blog/atom.xml" rel="alternate"><i class="fa fa-rss"></i>RSS</a></div><div class="links-of-author motion-element"><span class="links-of-author-item"><a href="https://github.com/haoliangyu" title="GitHub &rarr; https://github.com/haoliangyu" rel="noopener" target="_blank"><i class="fa fa-fw fa-github"></i>GitHub</a></span></div></div></div></aside><div id="sidebar-dimmer"></div></div></main><footer id="footer" class="footer"><div class="footer-inner"><div class="copyright">&copy; <span itemprop="copyrightYear">2019</span> <span class="with-love" id="animate"><i class="fa fa-user"></i> </span><span class="author" itemprop="copyrightHolder">Haoliang Yu</span></div><div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.9.0</div><span class="post-meta-divider">|</span><div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Muse</a> v7.3.0</div></div></footer></div><script src="/blog/lib/jquery/index.js?v=3.4.1"></script><script src="/blog/lib/velocity/velocity.min.js?v=1.2.1"></script><script src="/blog/lib/velocity/velocity.ui.min.js?v=1.2.1"></script><script src="/blog/js/utils.js?v=7.3.0"></script><script src="/blog/js/motion.js?v=7.3.0"></script><script src="/blog/js/schemes/muse.js?v=7.3.0"></script><script src="/blog/js/next-boot.js?v=7.3.0"></script><script src="/blog/js/local-search.js?v=7.3.0"></script><script>function loadCount(){var d=document,t=d.createElement("script");t.src="https://dz316424.disqus.com/count.js",t.id="dsq-count-scr",(d.head||d.body).appendChild(t)}window.addEventListener("load",loadCount,!1)</script><script>function disqus_config(){this.page.url="http://haoliangyu.github.io/blog/2015/02/19/Making-masks-from-Quality-Control-bits-of-MODIS-land-products-in-Python-Update/",this.page.identifier="2015/02/19/Making-masks-from-Quality-Control-bits-of-MODIS-land-products-in-Python-Update/",this.page.title="Making masks from Quality Control bits of MODIS land products in Python (Update)"}function loadComments(){if(window.DISQUS)DISQUS.reset({reload:!0,config:disqus_config});else{var t=document,i=t.createElement("script");i.src="https://dz316424.disqus.com/embed.js",i.setAttribute("data-timestamp",""+ +new Date),(t.head||t.body).appendChild(i)}}window.addEventListener("load",loadComments,!1)</script></body></html>